{# templates/barkat/staff/staff_list.html #} {% extends "base.html" %} {% load
static %} {% block content %}
<div class="p-4 md:p-6">
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-bold flex items-center gap-2">
      <i data-feather="users" class="w-7 h-7"></i>
      <span>Staff</span>
    </h1>

    <a
      href="{% url 'staff_add' %}"
      class="rounded-lg px-3 py-2 bg-slate-900 text-white hover:bg-slate-800"
    >
      + New Staff
    </a>
  </div>

  {# ---------- Modern tabs (links to per-business pages) ---------- #}
  <div class="mb-3">
    <div class="flex gap-2 overflow-x-auto pb-1 border-b border-slate-300">
      {# All Button (active on this page) #}
      <a
        href="{% url 'staff_list' %}"
        aria-current="page"
        data-tint="slate"
        class="inline-flex items-center gap-2 px-4 py-2 rounded-t-lg border text-sm font-medium transition-all duration-300 bg-slate-700 text-white border-slate-700 shadow-md"
      >
        All
      </a>

      {# Business Buttons #} {% for b in businesses %}
      <span class="hidden"
        >{% cycle 'indigo' 'emerald' 'rose' 'amber' as color %}</span
      >
      <a
        href="{% url 'business_staff' b.id %}"
        class="inline-flex items-center gap-2 px-4 py-2 rounded-t-lg border text-sm font-medium transition-all duration-300
                  text-{{ color }}-700 border-{{ color }}-300 hover:bg-{{ color }}-100 hover:border-{{ color }}-600 hover:text-{{ color }}-900"
      >
        {{ b.name }}
      </a>
      {% endfor %}
    </div>
  </div>

  {# ---------- Controls: Search + Page size (client-side) ---------- #}
  <div
    class="mb-3 flex flex-col sm:flex-row gap-2 sm:items-center sm:justify-between"
  >
    <div class="flex items-center gap-2">
      <label for="staffSearch" class="text-sm text-slate-600">Search:</label>
      <input
        id="staffSearch"
        type="search"
        placeholder="Type to filter…"
        class="w-64 max-w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm"
        autocomplete="off"
      />
    </div>
    <div class="flex items-center gap-2">
      <label for="staffPerPage" class="text-sm text-slate-600">Show</label>
      <select
        id="staffPerPage"
        class="rounded-lg border border-slate-300 bg-white px-2 py-2 text-sm"
      >
        <option value="10">10</option>
        <option value="25" selected>25</option>
        <option value="50">50</option>
        <option value="100">100</option>
      </select>
      <span class="text-sm text-slate-600">entries</span>
    </div>
  </div>

  {# ---------- Table (plain HTML) ---------- #}
  <div class="overflow-x-auto rounded-xl border border-slate-200 bg-white">
    <table id="staffTable" class="min-w-full text-sm">
      <thead class="bg-slate-50">
        <tr>
          <th class="px-4 py-2 text-left">Name</th>
          <th class="px-4 py-2 text-left">Business</th>
          <th class="px-4 py-2 text-left">Role</th>
          <th class="px-4 py-2 text-left">Phone</th>
          <th class="px-4 py-2 text-left">Access</th>
          <th class="px-4 py-2 text-left">User</th>
          <th class="px-4 py-2 text-right">Actions</th>
        </tr>
      </thead>
      <tbody id="staffBody">
        {% for s in staff_list %}
        <tr class="border-t">
          <td class="px-4 py-2 font-medium">{{ s.full_name }}</td>
          <td class="px-4 py-2">{{ s.business.name }}</td>
          <td class="px-4 py-2">{{ s.get_role_display }}</td>
          <td class="px-4 py-2">{{ s.phone|default:"—" }}</td>
          <td class="px-4 py-2">
            {% if s.has_software_access %}
            <span
              class="inline-flex items-center rounded-full px-2 py-0.5 text-xs bg-emerald-50 text-emerald-700 border border-emerald-200"
              >Enabled</span
            >
            {% else %}
            <span
              class="inline-flex items-center rounded-full px-2 py-0.5 text-xs bg-slate-100 text-slate-700 border border-slate-200"
              >No</span
            >
            {% endif %}
          </td>
          <td class="px-4 py-2">{{ s.user.username|default:"—" }}</td>
          <td class="px-4 py-2 text-right whitespace-nowrap">
            <a
              href="{% url 'staff_edit' s.pk %}"
              class="inline-flex items-center gap-1 rounded-md border border-indigo-300 text-indigo-700 px-2 py-1 text-xs hover:bg-indigo-50"
              >Edit</a
            >
            <a
              href="{% url 'staff_delete' s.pk %}"
              class="inline-flex items-center gap-1 rounded-md border border-rose-300 text-rose-700 px-2 py-1 text-xs hover:bg-rose-50 ml-1"
              >Delete</a
            >
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="px-4 py-6 text-center text-slate-500">
            No staff found.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {# ---------- Pagination (client-side) ---------- #}
  <div
    class="mt-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3"
  >
    <div id="staffInfo" class="text-sm text-slate-600">Showing 0 to 0 of 0</div>
    <div class="flex items-center gap-1">
      <button
        id="staffFirst"
        class="px-3 py-1 rounded border border-slate-300 text-sm hover:bg-slate-50"
      >
        First
      </button>
      <button
        id="staffPrev"
        class="px-3 py-1 rounded border border-slate-300 text-sm hover:bg-slate-50"
      >
        Prev
      </button>
      <span id="staffPage" class="px-3 py-1 text-sm text-slate-700"
        >Page 1 / 1</span
      >
      <button
        id="staffNext"
        class="px-3 py-1 rounded border border-slate-300 text-sm hover:bg-slate-50"
      >
        Next
      </button>
      <button
        id="staffLast"
        class="px-3 py-1 rounded border border-slate-300 text-sm hover:bg-slate-50"
      >
        Last
      </button>
    </div>
  </div>
</div>
{% endblock %} {% block all_scripts %}
<script>
  (function () {
    const tbody = document.getElementById("staffBody");
    const rowsAll = Array.from(tbody.querySelectorAll("tr"));
    const inp = document.getElementById("staffSearch");
    const sel = document.getElementById("staffPerPage");
    const btnFirst = document.getElementById("staffFirst");
    const btnPrev = document.getElementById("staffPrev");
    const btnNext = document.getElementById("staffNext");
    const btnLast = document.getElementById("staffLast");
    const lblPage = document.getElementById("staffPage");
    const lblInfo = document.getElementById("staffInfo");

    let term = "";
    let perPage = parseInt(sel.value, 10) || 25;
    let page = 1;

    const norm = (s) => (s || "").toString().toLowerCase();
    function matches(tr, t) {
      if (!t) return true;
      return Array.from(tr.children).some((td) =>
        norm(td.textContent).includes(t)
      );
    }

    function filtered() {
      return rowsAll.filter((tr) => matches(tr, term));
    }
    function totalPages(tot) {
      return Math.max(1, Math.ceil(tot / perPage));
    }
    function clamp(p, max) {
      return Math.min(Math.max(1, p), max);
    }

    function render() {
      const items = filtered();
      const tot = items.length;
      const pages = totalPages(tot);
      page = clamp(page, pages);
      const start = (page - 1) * perPage,
        end = Math.min(start + perPage, tot);
      const slice = items.slice(start, end);

      tbody.innerHTML = "";
      if (!slice.length) {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td colspan="7" class="px-4 py-6 text-center text-slate-500">No staff found.</td>`;
        tbody.appendChild(tr);
      } else {
        slice.forEach((tr) => tbody.appendChild(tr));
      }

      lblPage.textContent = `Page ${page} / ${pages}`;
      lblInfo.textContent = `Showing ${
        tot ? start + 1 : 0
      } to ${end} of ${tot}`;
      [btnFirst, btnPrev].forEach((b) => (b.disabled = page <= 1));
      [btnNext, btnLast].forEach((b) => (b.disabled = page >= pages));
    }

    inp.addEventListener("input", (e) => {
      term = norm(e.target.value);
      page = 1;
      render();
    });
    sel.addEventListener("change", (e) => {
      perPage = parseInt(e.target.value, 10) || 25;
      page = 1;
      render();
    });
    btnFirst.onclick = () => {
      page = 1;
      render();
    };
    btnPrev.onclick = () => {
      page--;
      render();
    };
    btnNext.onclick = () => {
      page++;
      render();
    };
    btnLast.onclick = () => {
      page = totalPages(filtered().length);
      render();
    };

    render();
  })();
</script>
{% endblock %}
