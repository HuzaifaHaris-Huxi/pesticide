{# templates/barkat/inventory/business_stock_status.html #}
{% extends "base.html" %}
{% load static %}
{% block content %}
<div class="p-4 md:p-6">

  <div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-bold flex items-center gap-2">
      <i data-feather="package" class="w-7 h-7"></i>
      <span>Stock — {{ business.name }}</span>
    </h1>

    <div class="flex gap-2">
      <a href="{% url 'business_refill' business.id %}"
         class="rounded-lg px-3 py-2 bg-emerald-700 text-white hover:bg-emerald-600">
         + Refill
      </a>

      <form method="get" action="{% url 'stock_move_b2w' %}" class="flex items-center gap-2">
        <input type="hidden" name="business" value="{{ business.id }}">
        <select name="dest_warehouse" class="rounded-lg border border-slate-300 px-3 py-2 bg-white">
          {% for wh in warehouses %}
            <option value="{{ wh.id }}">{{ wh.code }} — {{ wh.name }}</option>
          {% endfor %}
        </select>
        <button class="rounded-lg px-3 py-2 bg-indigo-700 text-white hover:bg-indigo-600">
          Move to Warehouse
        </button>
      </form>
    </div>
  </div>

  <div class="mb-3">
    <div class="flex gap-2 overflow-x-auto pb-1 border-b border-slate-300" data-tabs="businesses">
      <a href="{% url 'stock_status' %}"
         class="inline-flex items-center gap-2 px-4 py-2 rounded-t-lg border text-sm font-medium text-slate-600 border-slate-300 hover:bg-slate-200">All</a>

      {% for b in businesses %}
        <span class="hidden">{% cycle 'indigo' 'emerald' 'rose' 'amber' as color %}</span>
        {% if b.id == business.id %}
          <a href="{% url 'business_stock_status' b.id %}"
             aria-current="page"
             data-tint="{{ color }}"
             class="inline-flex items-center gap-2 px-4 py-2 rounded-t-lg border text-sm font-medium bg-{{ color }}-700 text-white border-{{ color }}-700 shadow-md">
             {{ b.name }}
          </a>
        {% else %}
          <a href="{% url 'business_stock_status' b.id %}"
             class="inline-flex items-center gap-2 px-4 py-2 rounded-t-lg border text-sm font-medium
                    text-{{ color }}-700 border-{{ color }}-300 hover:bg-{{ color }}-100 hover:border-{{ color }}-600 hover:text-{{ color }}-900">
             {{ b.name }}
          </a>
        {% endif %}
      {% endfor %}
    </div>
  </div>

  <form method="get" class="mb-3 flex gap-2">
    <input name="q" value="{{ query }}" type="search" placeholder="Search product, Company…"
           class="w-64 max-w-full rounded-lg border border-slate-300 bg-white px-3 py-2" />
    <button class="rounded-lg px-3 py-2 bg-slate-900 text-white hover:bg-slate-800">Filter</button>
    <a href="{% url 'business_stock_status' business.id %}"
       class="rounded-lg px-3 py-2 border border-slate-300 hover:bg-slate-50">Reset</a>
  </form>

  <div class="overflow-x-auto rounded-xl border border-slate-200 bg-white">
    <table class="min-w-full text-sm">
      <thead class="bg-slate-50">
        <tr>
          <th class="px-4 py-2 text-left">Product</th>
          <th class="px-4 py-2 text-left">Company</th>
          <th class="px-4 py-2 text-left">UOM</th>
          <th class="px-4 py-2 text-right">Qty</th>
        </tr>
      </thead>
      <tbody id="bodyTint">
        {% for p in rows %}
          <tr class="border-t">
            <td class="px-4 py-2">{{ p.name }}</td>
            <td class="px-4 py-2">{{ p.company_name }}</td>
            <td class="px-4 py-2">{{ p.uom.symbol|default:p.uom.code }}</td>
            <td class="px-4 py-2 text-right">{{ p.stock_qty|floatformat:2 }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="4" class="px-4 py-6 text-center text-slate-500">No products for {{ business.name }}.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}
{% block all_scripts %}
<script>
  (function () {
    const tabsWrap = document.querySelector('[data-tabs="businesses"]');
    const tbody = document.getElementById('bodyTint');
    if (!tabsWrap || !tbody) return;

    // Keep classes literal so Tailwind includes them
    const MAP = {
      slate:  { tbody: 'bg-slate-200',  hover: 'hover:bg-slate-50' },
      indigo: { tbody: 'bg-indigo-200', hover: 'hover:bg-indigo-50' },
      emerald:{ tbody: 'bg-emerald-200',hover: 'hover:bg-emerald-50' },
      rose:   { tbody: 'bg-rose-200',   hover: 'hover:bg-rose-50' },
      amber:  { tbody: 'bg-amber-200',  hover: 'hover:bg-amber-50' },
      sky:    { tbody: 'bg-sky-200',    hover: 'hover:bg-sky-50' },
      violet: { tbody: 'bg-violet-200', hover: 'hover:bg-violet-50' },
      teal:   { tbody: 'bg-teal-200',   hover: 'hover:bg-teal-50' },
      fuchsia:{ tbody: 'bg-fuchsia-200',hover: 'hover:bg-fuchsia-50' },
    };

    const ALL_TBODY = Object.values(MAP).map(x => x.tbody);
    const ALL_HOVER = Object.values(MAP).map(x => x.hover);

    function currentTintKey() {
      const active = tabsWrap.querySelector('[aria-current="page"]');
      return (active?.getAttribute('data-tint') || 'slate').trim();
    }

    function applyTint() {
      const key = currentTintKey();
      const tint = MAP[key] || MAP.slate;

      // tbody background
      tbody.classList.remove(...ALL_TBODY);
      tbody.classList.add(tint.tbody);

      // row hover
      Array.from(tbody.querySelectorAll('tr')).forEach(tr => {
        tr.classList.remove(...ALL_HOVER);
        tr.classList.add(tint.hover);
      });
    }

    applyTint(); // run once on load
  })();
</script>
{% endblock %}
